<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
  <head>
    <meta charset="utf-8" />
    <title>Vitour - Travel & Tour Booking HTML Template</title>

    <meta name="author" content="themesflat.com" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1"
    />

    <link rel="stylesheet" href="/app/css/app.css" />
    <link rel="stylesheet" href="/app/css/bootstrap-select.min.css" />
    <link rel="stylesheet" href="/app/css/map.min.css" />

    <!-- Favicon and Touch Icons  -->
    <link rel="shortcut icon" href="assets/images/favico.png" />
    <link rel="apple-touch-icon-precomposed" href="assets/images/favico.png" />
  </head>

  <body class="body header-fixed">
    <div class="preload preload-container">
      <svg class="pl" width="240" height="240" viewBox="0 0 240 240">
        <circle
          class="pl__ring pl__ring--a"
          cx="120"
          cy="120"
          r="105"
          fill="none"
          stroke="#000"
          stroke-width="20"
          stroke-dasharray="0 660"
          stroke-dashoffset="-330"
          stroke-linecap="round"
        ></circle>
        <circle
          class="pl__ring pl__ring--b"
          cx="120"
          cy="120"
          r="35"
          fill="none"
          stroke="#000"
          stroke-width="20"
          stroke-dasharray="0 220"
          stroke-dashoffset="-110"
          stroke-linecap="round"
        ></circle>
        <circle
          class="pl__ring pl__ring--c"
          cx="85"
          cy="120"
          r="70"
          fill="none"
          stroke="#000"
          stroke-width="20"
          stroke-dasharray="0 440"
          stroke-linecap="round"
        ></circle>
        <circle
          class="pl__ring pl__ring--d"
          cx="155"
          cy="120"
          r="70"
          fill="none"
          stroke="#000"
          stroke-width="20"
          stroke-dasharray="0 440"
          stroke-linecap="round"
        ></circle>
      </svg>
    </div>

    <!-- /preload -->

    <div id="wrapper">
      <div id="pagee" class="clearfix">
        <div class="sidebar-dashboard">
          <div class="db-logo">
            <a href="index.html"
              ><img
                src="/assests/images/logo/Shabz World Round Logo.png"
                alt="Logo"
              /><span>shabzworld</span></a
            >
          </div>
          <div class="db-menu">
            <ul>
              <li class="active">
                <a href="dashboard.html">
                  <i class="icon-Vector-9"></i>
                  <span>Dashboard</span>
                </a>
              </li>
              <li>
                <a href="/admin/my-listing.html">
                  <i class="icon-Group-81"></i>
                  <span>My Listing</span>
                </a>
              </li>
              <li>
                <a href="/admin/add-tour.html">
                  <i class="icon-Group-91"></i>
                  <span>Add Tour</span>
                </a>
              </li>

              <li>
                <a href="#" id="logout-btn">
                  <i class="icon-turn-off-1"></i>
                  <span>Logout</span>
                </a>
              </li>
            </ul>
          </div>
        </div>

        <div class="has-dashboard">
          <!-- Main Header -->
          <header class="main-header flex">
            <!-- Header Lower -->
            <div id="header">
              <div class="header-dashboard">
                <div class="tf-container full">
                  <div class="row">
                    <div class="col-lg-12">
                      <div
                        class="inner-container flex justify-space align-center"
                      >
                        <!-- Logo Box -->
                        <div class="header-search flex-three">
                          <div class="icon-bars">
                            <i class="icon-Vector3"></i>
                          </div>
                          <form action="/" class="search-dashboard">
                            <i class="icon-Vector5"></i>
                            <input type="search" placeholder="Search tours" />
                          </form>
                        </div>
                        <div class="nav-outer flex align-center">
                          <!-- Main Menu -->
                          <nav class="main-menu show navbar-expand-md">
                            <div
                              class="navbar-collapse collapse clearfix"
                              id="navbarSupportedContent"
                            >
                              <ul class="navigation clearfix">
                                <li class="current"><a href="#"></a></li>
                                <li><a href="contact-us.html">Contact</a></li>
                              </ul>
                            </div>
                          </nav>
                          <!-- Main Menu End-->
                        </div>
                        <div class="header-account flex align-center">
                          <div class="dropdown notification">
                            <a
                              class="icon-notification"
                              type="button"
                              data-bs-toggle="dropdown"
                              aria-expanded="false"
                            >
                              <i class="icon-notification-1"></i>
                            </a>
                            <ul class="dropdown-menu">
                              <li>
                                <div class="message-item flex-three">
                                  <div class="image">
                                    <i class="icon-26"></i>
                                  </div>
                                  <div>
                                    <div class="body-title">
                                      Discount available
                                    </div>
                                    <div class="text-tiny">
                                      Morbi sapien massa, ultricies at rhoncus
                                      at, ullamcorper nec diam
                                    </div>
                                  </div>
                                </div>
                              </li>
                              <li>
                                <div class="message-item flex-three">
                                  <div class="image">
                                    <i class="icon-26"></i>
                                  </div>
                                  <div>
                                    <div class="body-title">
                                      Discount available
                                    </div>
                                    <div class="text-tiny">
                                      Morbi sapien massa, ultricies at rhoncus
                                      at, ullamcorper nec diam
                                    </div>
                                  </div>
                                </div>
                              </li>
                              <li>
                                <div class="message-item flex-three">
                                  <div class="image">
                                    <i class="icon-26"></i>
                                  </div>
                                  <div>
                                    <div class="body-title">
                                      Discount available
                                    </div>
                                    <div class="text-tiny">
                                      Morbi sapien massa, ultricies at rhoncus
                                      at, ullamcorper nec diam
                                    </div>
                                  </div>
                                </div>
                              </li>
                            </ul>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- End Header Lower -->

            <!-- Mobile Menu  -->
            <div class="close-btn">
              <span class="icon flaticon-cancel-1"></span>
            </div>
            <div class="mobile-menu">
              <div class="menu-backdrop"></div>
              <nav class="menu-box">
                <div class="nav-logo">
                  <a href="index.html">
                    <img src="assets/images/logo2.png" alt=""
                  /></a>
                </div>
                <div class="bottom-canvas">
                  <div class="menu-outer"></div>
                </div>
              </nav>
            </div>
            <!-- End Mobile Menu -->
          </header>
          <!-- End Main Header -->
          <main id="main">
            <section class="profile-dashboard">
              <div class="inner-header mb-40">
                <h3 class="title">My Listings</h3>
                <p class="des">
                  There are many variations of passages of Lorem Ipsum
                </p>
              </div>
              <div class="favorite-wrap">
                <div id="tour-container" class="my-listing-grid mb-50"></div>
                <div class="row">
                  <div class="col-md-12">
                    <ul class="tf-pagination flex-five"></ul>
                  </div>
                </div>
              </div>
            </section>
          </main>

          <footer class="footer footer-dashboard">
            <div class="tf-container full">
              <div class="row">
                <div class="col-xl-6">
                  <p class="text-white">
                    Copyright © 2025 by SHABZ WORLD TOURISM All Rights Reserved
                  </p>
                </div>
                <div class="col-xl-6">
                  <ul class="menu-footer flex-six">
                    <li>
                      <a href="#">Privacy & Policy</a>
                    </li>
                    <li>
                      <a href="#">Licensing</a>
                    </li>
                    <li>
                      <a href="#">Instruction</a>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </footer>

          <!-- Bottom -->
        </div>
      </div>
      <!-- /#page -->
    </div>

    <!-- Modal Popup Bid -->

    <a id="scroll-top" class="button-go"></a>

    <!-- Modal search-->
    <div
      class="modal search-mobie fade"
      id="exampleModal"
      tabindex="-1"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
          <div class="modal-body">
            <form action="/" class="search-form-mobie">
              <div class="search">
                <i class="icon-circle2017"></i>
                <input
                  type="search"
                  placeholder="Search Travel"
                  class="search-input"
                  autocomplete="off"
                />
                <button type="button">Search</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <!-- Javascript -->
    <script src="/app/js/jquery.min.js"></script>
    <script src="/app/s/jquery.nice-select.min.js"></script>
    <script src="/app/js/bootstrap.min.js"></script>
    <script src="/app/js/bootstrap-select.min.js"></script>
    <script src="/app/js/tinymce/tinymce.min.js"></script>
    <script src="/app/js/tinymce/tinymce-custom.js"></script>
    <script src="/app/js/swiper-bundle.min.js"></script>
    <script src="/app/js/swiper.js"></script>
    <script src="/app/js/plugin.js"></script>
    <script src="/app/js/map.min.js"></script>
    <script src="/app/js/map.js"></script>
    <script src="/app/js/countto.js"></script>
    <script src="/app/js/apexcharts.js"></script>
    <script src="/app/js/line-chart.js"></script>
    <script src="/app/js/shortcodes.js"></script>
    <script src="/app/js/main.js"></script>

    <script type="module">
      // Import Firebase modules
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
      import {
        getAuth,
        onAuthStateChanged,
        signOut,
      } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
      import {
        getFirestore,
        collection,
        query,
        getDocs,
        orderBy,
        limit,
        startAfter,
        endBefore,
        limitToLast,
      } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
      import {
        doc,
        deleteDoc,
      } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

      // Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyAqzjDSYawZr9IdPR8Yr5pIhTxdei10DRA",
        authDomain: "travel-agency-3ea70.firebaseapp.com",
        projectId: "travel-agency-3ea70",
        storageBucket: "travel-agency-3ea70.appspot.com",
        messagingSenderId: "630304664282",
        appId: "1:630304664282:web:12a885b210b77cf77f53e3",
        measurementId: "G-GM0QYDSV1F",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      // Variables
      const container = document.getElementById("tour-container");
      const paginationElement = document.querySelector(".tf-pagination");
      const itemsPerPage = 6;
      let currentPage = 1;
      let firstVisible = null;
      let lastVisible = null;
      let totalDocs = 0;

      // Auth check
      onAuthStateChanged(auth, (user) => {
        if (!user) {
          window.location.href = "/admin/login.html";
        } else {
          loadTours();
        }
      });

      // Logout handler
      const logoutBtn = document.getElementById("logout-btn");
      if (logoutBtn) {
        logoutBtn.addEventListener("click", () => {
          signOut(auth)
            .then(() => (window.location.href = "login.html"))
            .catch((error) => {
              console.error("Logout error:", error);
              alert("Failed to logout. Try again.");
            });
        });
      }

      container.addEventListener("click", async (e) => {
        if (e.target.classList.contains("delete-btn")) {
          const id = e.target.dataset.id;
          const confirmDelete = confirm(
            "Are you sure you want to delete this tour?"
          );
          if (!confirmDelete) return;

          try {
            const docRef = doc(db, "tourPackages", id);
            await deleteDoc(docRef);
            alert("Tour deleted successfully.");
            lastVisible = null;
            firstVisible = null;
            currentPage = 1;
            loadTours("reset");
          } catch (error) {
            console.error("Error deleting tour:", error);
            alert("Failed to delete tour.");
          }
        }
      });

      // Load tours from Firestore
      async function loadTours(direction = "next") {
        try {
          container.innerHTML = "";
          let q;
          const toursRef = collection(db, "tourPackages");

          if (direction === "reset") {
            q = query(toursRef, orderBy("title"), limit(itemsPerPage));
          } else if (direction === "next" && lastVisible) {
            q = query(
              toursRef,
              orderBy("title"),
              startAfter(lastVisible),
              limit(itemsPerPage)
            );
          } else if (direction === "prev" && firstVisible) {
            q = query(
              toursRef,
              orderBy("title"),
              endBefore(firstVisible),
              limitToLast(itemsPerPage)
            );
          } else {
            q = query(toursRef, orderBy("title"), limit(itemsPerPage));
          }

          const querySnapshot = await getDocs(q);
          totalDocs = querySnapshot.size;

          if (querySnapshot.docs.length > 0) {
            firstVisible = querySnapshot.docs[0];
            lastVisible = querySnapshot.docs[querySnapshot.docs.length - 1];

            querySnapshot.forEach((doc) => {
              const tour = doc.data();
              const tourId = doc.id;
              container.innerHTML += `
                <div class="my-listing-item flex-three">
                  <div class="image relative">
                    <img src="${tour.image}" alt="${tour.alt || "Tour Image"}">
                    <span class="featured">Featured</span>
                  </div>
                  <div class="content">
                    <div class="flex-two">
                      <span class="map"><i class="icon-Vector-15"></i>${
                        tour.location
                      }</span>
                      <div class="flex">
                        <span class="media"><i class="icon-Group-1000002909"></i>5</span>
                        <span class="media"><i class="icon-Group-1000002910"></i>2</span>
                      </div>
                    </div>
                    <h6 class="title-listing"><a href="#">${tour.title}</a></h6>
                    <div class="review">
                      <i class="icon-Star"></i><i class="icon-Star"></i><i class="icon-Star"></i><i class="icon-Star"></i><i class="icon-Star"></i>
                      <span>(1 Review)</span>
                    </div>
                    <ul class="list-meta flex-three">
                      <li><i class="icon-time-left"></i><span>5 days</span></li>
                      <li><i class="icon-Vector-6"></i><span>12 Person</span></li>
                    </ul>
                    <button class="delete-btn" data-id="${tourId}" style="margin-top:10px;color:#fff;background:#e74c3c;border:none;padding:6px 12px;border-radius:4px;cursor:pointer;">Delete</button>
                  </div>
                </div>
              `;
            });
          } else {
            container.innerHTML = "<p>No tour packages found.</p>";
          }

          updatePaginationControls();
        } catch (error) {
          console.error("Error loading tours:", error);
          container.innerHTML = `<p class="error">Failed to load tours. ${error.message}</p>`;
        }
      }

      // Pagination controls
      function updatePaginationControls() {
        paginationElement.innerHTML = `
          <li>
            <a class="pages-link prev-btn" href="#" ${
              currentPage === 1
                ? 'style="pointer-events: none; opacity: 0.5;"'
                : ""
            }>
              <i class="icon-29"></i>
            </a>
          </li>
          <li class="pages-item active">
            <span class="pages-link">${currentPage}</span>
          </li>
          <li>
            <a class="pages-link next-btn" href="#" ${
              totalDocs < itemsPerPage
                ? 'style="pointer-events: none; opacity: 0.5;"'
                : ""
            }>
              <i class="icon--1"></i>
            </a>
          </li>
        `;

        document
          .querySelector(".prev-btn")
          ?.addEventListener("click", previousPage);
        document
          .querySelector(".next-btn")
          ?.addEventListener("click", nextPage);
      }

      function nextPage(e) {
        e.preventDefault();
        if (totalDocs === itemsPerPage) {
          currentPage++;
          loadTours("next");
        }
      }

      function previousPage(e) {
        e.preventDefault();
        if (currentPage > 1) {
          currentPage--;
          loadTours("prev");
        }
      }

      // Delete tour handler
    </script>
  </body>
</html>
