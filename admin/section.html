<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <!-- admin-add-tour.html -->
    <section class="admin-add-tour">
      <div class="tf-container">
        <h2>Add New Tour Package</h2>
        <form id="tourForm" class="tf-my-listing1">
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label>Tour Image</label>
                <input
                  type="file"
                  id="imageUpload"
                  accept="image/*"
                  class="form-control"
                  required
                />
                <div id="imagePreview" class="mt-2"></div>
              </div>
              <div class="form-group">
                <label>Alt Text</label>
                <input type="text" id="alt" class="form-control" required />
              </div>
              <div class="form-group">
                <label>Location</label>
                <input
                  type="text"
                  id="location"
                  class="form-control"
                  required
                />
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label>Title</label>
                <input type="text" id="title" class="form-control" required />
              </div>
            </div>
            <div class="col-md-12">
              <div class="form-group">
                <label>Rating (1-5)</label>
                <input
                  type="number"
                  id="rating"
                  min="1"
                  max="5"
                  step="0.5"
                  class="form-control"
                  required
                />
              </div>
              <div class="form-group">
                <label>Category</label>
                <select id="category" class="form-control">
                  <option value="landmarks">Landmarks</option>
                  <option value="adventure">Adventure</option>
                  <option value="cultural">Cultural</option>
                </select>
              </div>
              <button type="submit" class="btn btn-primary">
                Add Tour Package
              </button>
            </div>
          </div>
        </form>
      </div>
    </section>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.8/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.8/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.8/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.8/firebase-auth-compat.js"></script>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.8/firebase-app.js";
      import {
        getFirestore,
        collection,
        addDoc,
      } from "https://www.gstatic.com/firebasejs/9.6.8/firebase-firestore.js";
      import {
        getStorage,
        ref,
        uploadBytes,
        getDownloadURL,
      } from "https://www.gstatic.com/firebasejs/9.6.8/firebase-storage.js";

      const firebaseConfig = {
        apiKey: "AIzaSyBvrlBGwSrZtFWVpgIFiebPc6sGAc3_TZQ",
        authDomain: "shabz-tour-project.firebaseapp.com",
        projectId: "shabz-tour-project",
        storageBucket: "shabz-tour-project.firebasestorage.app",
        messagingSenderId: "660247483046",
        appId: "1:660247483046:web:cbb9b8f128e6ea7a029a67",
        measurementId: "G-B2JNT1JNQF"
    };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const storage = getStorage(app);

      // Image preview handler
      document
        .getElementById("imageUpload")
        .addEventListener("change", function (e) {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
              document.getElementById("imagePreview").innerHTML = `
                    <img src="${e.target.result}" class="preview-image" style="max-width: 200px;">
                `;
            };
            reader.readAsDataURL(file);
          }
        });

      // Form submission handler
      document
        .getElementById("tourForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const file = document.getElementById("imageUpload").files[0];
          if (!file) {
            alert("Please select an image");
            return;
          }

          try {
            const storageRef = ref(
              storage,
              `tour-images/${Date.now()}_${file.name}`
            );
            const uploadTask = await uploadBytes(storageRef, file, {
              contentType: file.type,
            });
            const imageUrl = await getDownloadURL(uploadTask.ref);

            // Create tour data with the uploaded image URL
            const tourData = {
              image: imageUrl,
              alt: document.getElementById("alt").value,
              location: document.getElementById("location").value,
              title: document.getElementById("title").value,
              rating: parseFloat(document.getElementById("rating").value),
              category: {
                value: document.getElementById("category").value,
                display:
                  document.getElementById("category").options[
                    document.getElementById("category").selectedIndex
                  ].text,
              },
              section: {
                value: "topExp",
                display: "Top experiences in Dubai",
              },
            };

            // Save to Firestore
            await addDoc(collection(db, "tour-packages"), tourData);
            alert("Tour package added successfully!");
            document.getElementById("tourForm").reset();
            document.getElementById("imagePreview").innerHTML = "";
          } catch (error) {
            console.error("Error:", error);
            alert("Error adding tour package!");
          }
        });
    </script>
  </body>
</html>
